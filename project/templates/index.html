{% extends "base.html" %}
{% block title %}
Studio Reactor Raspberry Pi Flask
{% endblock %}

{% block contentblock %}
<div class="post">
{#  	<h2>HuBo Home</h2> #}
    <div class="groep">
        <span class="meta">{{ ctx.now.strftime('%Y-%m-%d') }}</span>
    </div>
    <div class="groep">
        <div>
            <label style="width:160px;">Thermostaat actueel</label>
        </div>
        <div>
	    <input id="ex8" data-slider-id='ex1Slider' type="text" 
data-slider-min="14" data-slider-max="25" data-slider-step="1" data-slider-value="15"/>
        </div>
        <div>
            <label style="width:160px;">Actuele temp.</label>
            <span id="curTemp">-</span>
        </div>
{#        <div> #}
{#            <label style="width:160px;">Thermostaat stand</label> #}
{#            <span id="curPotPos">-</span><span id="curPotPosRaw"></span> #}
{#        </div> #}
        <div>
{#            <div class="loader setpoint-keuken center-block" style="display: none;"></div> #}
{#            <div id="setpoint-keuken"></div> #}
{#            <label style="width:60px;">laag</label>#}
{#            <!-- button class="btn btn-primary temp" data-value="0">14</button -->#}
{#            <button class="btn btn-primary temp" data-value="150">15</button>#}
{#            <button class="btn btn-primary temp" data-value="90">16</button>#}
{#            <button class="btn btn-primary temp" data-value="80">17</button>#}
{#        </div>#}
{#        <div>#}
{#            <label style="width:60px;">middel</label>#}
{#            <button class="btn btn-primary temp" data-value="70">18</button>#}
{#            <button class="btn btn-primary temp" data-value="60">19</button>#}
{#            <button class="btn btn-primary temp" data-value="55">19.5</button>#}
{#        </div>#}
{#        <div>#}
{#            <label style="width:60px;">hoog</label>#}
{#            <button class="btn btn-primary temp" data-value="50">20</button>#}
{#            <button class="btn btn-primary temp" data-value="45">20.5</button>#}
{#            <button class="btn btn-primary temp" data-value="40">21</button>#}
{#        </div>#}

    </div>
    <div class="groep">
        <h3>Groepen</h3>
        <div>
            <label style="width:160px;">Alles boven</label>
            <button class="btn btn-primary kika" data-address="bovenonly" data-state="on">Aan</button>
            <button class="btn btn-primary kika" data-address="bovenonly" data-state="off">Uit</button>
        </div>
        <div>
            <label style="width:160px;">Alles beneden</label>
            <button class="btn btn-primary kika" data-address="benedenonly" data-state="on">Aan</button>
            <button class="btn btn-primary kika" data-address="benedenonly" data-state="off">Uit</button>
        </div>
    </div>
    <div class="groep">
        <h3>Per stuk</h3>
        {% for switch in switches %}
{#            {{ switch }}#}
            <div>
                <label style="width:160px;">{{ switch.0 }}</label>
                <button class="btn btn-primary kika" data-address="lamp/{{ switch.1 }}" data-state="on">Aan</button>
                <button class="btn btn-primary kika" data-address="lamp/{{ switch.1 }}" data-state="off">Uit</button>
            </div>
        {% endfor %}
    </div>
{#    <div>#}
{#        <label style="width:160px;">Alle lampen</label>#}
{#        <button class="btn btn-primary kika" data-address="lightsonly" data-state="on">Aan</button>#}
{#        <button class="btn btn-primary kika" data-address="lightsonly" data-state="off">Uit</button>#}
{#    </div>#}
    <div class="groep">
        <h3>Alles</h3>
        <div>
            <label style="width:160px;">Alle schakelaars</label>
            <button class="btn btn-primary kika" data-address="all" data-state="on">Aan</button>
            <button class="btn btn-primary kika" data-address="all" data-state="off">Uit</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script>
    $(function(){
        $('button.kika').click(function() {
            var thebutton = $(this);
            var button_prev = thebutton.text();
            thebutton.text('...');
            var addr = $(this).attr('data-address');
            var state = $(this).attr('data-state');
            var urls = addr.split(',');
            $.each( urls, function( index, value ){
                console.log(value);
                $.get('/'+value+'/'+state+'/', function(data){
                    thebutton.text(button_prev);
                });
            });
        });

        $('button.temp').click(function() {
            // DIT IS NU OBSOLETE
            var thebutton = $(this).button();
            var button_prev = thebutton.text();
            thebutton.text('...');
            var newValue = $(this).attr('data-value');
            // waarde instellen
            var requestURL = '/servo/' + newValue + '/';
            $.get( requestURL, function(data){
                thebutton.text(data);
                setTimeout(function(){
                    // na 1 sec. oorspronkelijke label terug op button
                    thebutton.text(button_prev);
                }, 1000);
            });
        });
    });

    // window.setInterval(function() {
    //    fetch_temp();
    // }, 5000);

    var fetch_temp = function(){
        var requestURL = "/temp/";

        $.get(requestURL, function(jsonstr) {
             var json = JSON.parse(jsonstr);
             var realtemp = Math.round((json.temp - 3.3)*10)/10;
             var hum = json.hum;
             var actualsetpoint = json.actual_temp;
             $("#curTemp").html(realtemp + "&deg;");
             $("#curTemp")[0].style.fontSize = "20px";
             console.log(realtemp + " - " + hum + " - " + actualsetpoint);
             $("#ex8").slider('setValue', actualsetpoint);
        });
        window.setTimeout(function(){
            fetch_temp()
        }, 5000);
    };

    function onValueChange (e) {
        var newValue = servoVal1(e);
        console.log(newValue);
        var requestURL = '/servo/' + newValue + '/';
        $(".loader.setpoint-keuken").show();
        $.get( requestURL, function(data){
            setTimeout(function(){
                $(".loader.setpoint-keuken").hide();
            }, 1000);
        });
    };

    var temp_servo_vals = [
        "150", "100", "90",
        "85", "80", "75",
        "70", "65", "60",
        "55", "50", "45",
        "40", "35", "30"
    ];

    var temps = [
        "15", "15.5", "16",
        "16.5", "17", "17.5",
        "18", "18.5", "19",
        "19.5", "20", "20.5",
        "21", "21.5", "22"
    ];

    function servoVal1(args) {

        return temp_servo_vals[args.value];
    };

    function tooltipVal1(args) {

        return temps[args.value];
    };


    $(document).ready(function() {

	// With JQuery
	$("#ex8").slider({
            tooltip: 'always',
            precision: 1,
	});

	$("#ex8").on('slideStop', function(elem){
            console.log("new slider value: " + elem.value);
            var requestURL = "/set_temp/" + elem.value + "/";

            $.get(requestURL, function(jsonstr) {
              var json = JSON.parse(jsonstr);
            });

        });

        fetch_temp();
	
    });
    </script>
{% endblock %}
