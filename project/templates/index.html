{% extends "base.html" %}
{% block title %}
Egoactive Raspberry Pi Flask
{% endblock %}

{% block contentblock %}
<div class="post">
  	<h1>Klik Aan Klik Uit schakelaars</h1>
	<span class="meta">{{ ctx.now.strftime('%Y-%m-%d') }}</span>
    {% for switch in switches %}
{#        {{ switch }}#}
        <div>
            <label style="width:160px;">{{ switch.0 }}</label>
            <button class="btn btn-primary" data-address="lamp/{{ switch.1 }}" data-state="on">Aan</button>
            <button class="btn btn-primary" data-address="lamp/{{ switch.1 }}" data-state="off">Uit</button>
        </div>
    {% endfor %}
    <br>
    <div>
{#	 <label style="width:160px;">Allemaal (parallel doesn't work)</label>
        <button class="btn btn-primary" data-address="{{ all_urls }}" data-state="on">Aan</button>
        <button class="btn btn-primary" data-address="{{ all_urls }}" data-state="off">Uit</button>
#}
        <label style="width:160px;">Alle lampen</label>
        <button class="btn btn-primary" data-address="lightsonly" data-state="on">Aan</button>
        <button class="btn btn-primary" data-address="lightsonly" data-state="off">Uit</button>
    </div>
    <div>
        <label style="width:160px;">Alle schakelaars</label>
        <button class="btn btn-primary" data-address="all" data-state="on">Aan</button>
        <button class="btn btn-primary" data-address="all" data-state="off">Uit</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script>
    $(function(){
    $('button').click(function() {
        var thebutton = $(this).button();
        var button_prev = thebutton.text();
        thebutton.text('...');
        var addr = $(this).attr('data-address');
        var state = $(this).attr('data-state');
        var urls = addr.split(',');
        $.each( urls, function( index, value ){
            console.log(value);
            $.get('/'+value+'/'+state+'/', function(data){
                thebutton.text(button_prev);
            });
        });
        });
    });
    </script>
{% endblock %}
